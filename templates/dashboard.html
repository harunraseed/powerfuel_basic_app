<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Body Composition Assessments</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            color: white;
            padding: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header h1 {
            font-size: 2em;
        }

        .nav-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 25px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498DB 0%, #2980B9 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%);
            color: white;
            font-size: 0.9em;
            padding: 8px 15px;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .email-status {
            display: inline-block;
            font-size: 1.2em;
            margin-right: 5px;
        }

        .email-sent {
            color: #27AE60;
            cursor: help;
        }

        .email-not-sent {
            color: #95A5A6;
            cursor: help;
        }

        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .popup-overlay.show {
            display: flex;
        }

        .popup {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            animation: popupSlide 0.3s ease-out;
        }

        @keyframes popupSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .popup-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .popup-success {
            color: #27AE60;
        }

        .popup-error {
            color: #E74C3C;
        }

        .popup-message {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2C3E50;
        }

        .dashboard-content {
            padding: 40px;
        }

        .search-section {
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 15px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            font-size: 1em;
        }

        .search-input:focus {
            outline: none;
            border-color: #3498DB;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 1em;
            opacity: 0.9;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #3498DB 0%, #2980B9 100%);
            color: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
        }

        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid #E0E0E0;
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: #F8F9FA;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.85em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-info {
            background: #3498DB;
            color: white;
        }

        .btn-info:hover {
            background: #2980B9;
        }

        .btn-success {
            background: #2ECC71;
            color: white;
        }

        .btn-success:hover {
            background: #27AE60;
        }

        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498DB;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #7F8C8D;
            font-size: 1.1em;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            font-weight: 500;
            display: none;
        }

        .message.success {
            background: #D4EDDA;
            color: #155724;
            border: 1px solid #C3E6CB;
        }

        .message.error {
            background: #F8D7DA;
            color: #721C24;
            border: 1px solid #F5C6CB;
        }

        .message.show {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 3% auto;
            padding: 0;
            border: 1px solid #888;
            border-radius: 15px;
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .close {
            color: white;
            font-size: 35px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close:hover {
            color: #E74C3C;
            transform: scale(1.2);
        }

        .modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .inference-section {
            margin-bottom: 25px;
        }

        .inference-section h3 {
            color: #2C3E50;
            border-bottom: 2px solid #3498DB;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        .inference-item {
            background: #F8F9FA;
            padding: 15px;
            border-left: 4px solid #3498DB;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .inference-item strong {
            color: #2C3E50;
            display: block;
            margin-bottom: 5px;
        }

        .inference-value {
            font-size: 1.1em;
            color: #34495E;
        }

        .performance-notes {
            background: #FFF9E6;
            border-left: 4px solid #F39C12;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .performance-notes h4 {
            color: #E67E22;
            margin-bottom: 10px;
        }

        .performance-notes ul {
            list-style: none;
            padding: 0;
        }

        .performance-notes li {
            padding: 8px 0;
            border-bottom: 1px solid #F4E6C9;
        }

        .performance-notes li:last-child {
            border-bottom: none;
        }

        .btn-view {
            background: #9B59B6;
            color: white;
        }

        .btn-view:hover {
            background: #8E44AD;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }

            .nav-buttons {
                width: 100%;
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .dashboard-content {
                padding: 20px;
            }

            table {
                font-size: 0.85em;
            }

            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Assessment Dashboard</h1>
            <div class="nav-buttons">
                <a href="/form" class="btn btn-primary">‚ûï New Assessment</a>
                <a href="/logout" class="btn" style="background: #95A5A6; color: white;">üö™ Logout</a>
            </div>
        </div>

        <div class="dashboard-content">
            <div class="message" id="message"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalCount">0</h3>
                    <p>Total Assessments</p>
                </div>
                <div class="stat-card">
                    <h3 id="todayCount">0</h3>
                    <p>Today's Assessments</p>
                </div>
            </div>

            <div class="search-section">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="üîç Search by name, email, or mobile..."
                >
                <button onclick="searchAssessments()" class="btn btn-primary">Search</button>
                <button onclick="clearSearch()" class="btn" style="background: #95A5A6; color: white;">Clear</button>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading assessments...</p>
            </div>

            <div class="table-container">
                <table id="assessmentsTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Age</th>
                            <th>Gender</th>
                            <th>Email Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="assessmentsBody">
                        <tr>
                            <td colspan="5" class="no-data">No assessments found</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Success/Error Popup -->
    <div id="popupOverlay" class="popup-overlay">
        <div class="popup">
            <div class="popup-icon" id="popupIcon"></div>
            <div class="popup-message" id="popupMessage"></div>
        </div>
    </div>

    <!-- Inference Modal -->
    <div id="inferenceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üèÉ‚Äç‚ôÇÔ∏è Runner Assessment & Inference</h2>
                <span class="close" onclick="closeInferenceModal()">&times;</span>
            </div>
            <div class="modal-body" id="inferenceContent">
                <div class="loading show">
                    <div class="spinner"></div>
                    <p>Loading inference...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allAssessments = [];

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.className = `message ${type} show`;
            setTimeout(() => {
                messageDiv.className = 'message';
            }, 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').className = show ? 'loading show' : 'loading';
        }

        async function loadAssessments(search = '') {
            showLoading(true);
            try {
                const url = search ? `/api/assessments?search=${encodeURIComponent(search)}` : '/api/assessments';
                const response = await fetch(url);
                const result = await response.json();

                if (result.success) {
                    allAssessments = result.data;
                    displayAssessments(result.data);
                    updateStats(result.data);
                } else {
                    showMessage('Failed to load assessments', 'error');
                }
            } catch (error) {
                showMessage('Error: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function displayAssessments(assessments) {
            const tbody = document.getElementById('assessmentsBody');
            
            if (!assessments || assessments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="no-data">No assessments found</td></tr>';
                return;
            }

            tbody.innerHTML = assessments.map(a => `
                <tr>
                    <td><strong>${a.name}</strong></td>
                    <td>${a.age}</td>
                    <td>${a.gender.charAt(0).toUpperCase() + a.gender.slice(1)}</td>
                    <td>
                        ${a.email_sent ? 
                            `<span class="email-status email-sent" title="Email sent on ${a.email_sent_at ? new Date(a.email_sent_at).toLocaleString() : 'Unknown'}">‚úÖ</span>` : 
                            `<span class="email-status email-not-sent" title="Email not sent">‚ùå</span>`
                        }
                    </td>
                    <td>
                        <div class="action-buttons">
                            <button onclick="viewInference(${a.id})" class="btn-small btn-view">üëÅÔ∏è View</button>
                            <button onclick="downloadPDF(${a.id}, '${a.name}')" class="btn-small btn-info">üìÑ PDF</button>
                            <button onclick="sendEmail(${a.id})" class="btn-small btn-success">üìß Email</button>
                            <button onclick="deleteAssessment(${a.id}, '${a.name}')" class="btn-small btn-danger">üóëÔ∏è Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateStats(assessments) {
            document.getElementById('totalCount').textContent = assessments.length;
            
            const today = new Date().toDateString();
            const todayCount = assessments.filter(a => 
                new Date(a.created_at).toDateString() === today
            ).length;
            document.getElementById('todayCount').textContent = todayCount;
        }

        async function downloadPDF(assessmentId, name) {
            try {
                const response = await fetch(`/api/generate-pdf/${assessmentId}`);
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `body_assessment_${name.replace(' ', '_')}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    showPopup('‚úÖ', 'PDF Generated Successfully!', 'success');
                } else {
                    showPopup('‚ùå', 'Failed to generate PDF', 'error');
                }
            } catch (error) {
                showPopup('‚ùå', 'Error: ' + error.message, 'error');
            }
        }

        async function sendEmail(assessmentId) {
            if (!confirm('Send assessment report to client via email?')) {
                return;
            }

            try {
                const response = await fetch(`/api/send-email/${assessmentId}`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showPopup('‚úÖ', 'Email Sent Successfully!', 'success');
                    // Reload assessments to update email status
                    setTimeout(() => loadAssessments(), 2000);
                } else {
                    showPopup('‚ùå', result.message, 'error');
                }
            } catch (error) {
                showPopup('‚ùå', 'Error: ' + error.message, 'error');
            }
        }

        async function deleteAssessment(assessmentId, name) {
            if (!confirm(`Are you sure you want to delete assessment for ${name}? This action cannot be undone.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/delete-assessment/${assessmentId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showPopup('‚úÖ', 'Assessment Deleted Successfully!', 'success');
                    // Reload assessments
                    setTimeout(() => loadAssessments(), 2000);
                } else {
                    showPopup('‚ùå', result.message, 'error');
                }
            } catch (error) {
                showPopup('‚ùå', 'Error: ' + error.message, 'error');
            }
        }

        function showPopup(icon, message, type) {
            const overlay = document.getElementById('popupOverlay');
            const iconEl = document.getElementById('popupIcon');
            const messageEl = document.getElementById('popupMessage');
            
            iconEl.textContent = icon;
            iconEl.className = `popup-icon ${type === 'success' ? 'popup-success' : 'popup-error'}`;
            messageEl.textContent = message;
            
            overlay.classList.add('show');
            
            setTimeout(() => {
                overlay.classList.remove('show');
            }, 3000);
        }

        function searchAssessments() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            loadAssessments(searchTerm);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            loadAssessments();
        }

        // Search on Enter key
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchAssessments();
            }
        });

        // Load assessments on page load
        loadAssessments();

        async function viewInference(assessmentId) {
            const modal = document.getElementById('inferenceModal');
            const content = document.getElementById('inferenceContent');
            
            modal.className = 'modal show';
            content.innerHTML = `
                <div class="loading show">
                    <div class="spinner"></div>
                    <p>Loading inference...</p>
                </div>
            `;

            try {
                const response = await fetch(`/api/inference/${assessmentId}`);
                const result = await response.json();

                if (result.success) {
                    const assessment = result.assessment;
                    const inference = result.inference;
                    
                    content.innerHTML = `
                        <div class="inference-section">
                            <h3>üìã Client Information</h3>
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                <div><strong>Name:</strong> ${assessment.name}</div>
                                <div><strong>Age:</strong> ${assessment.age} years</div>
                                <div><strong>Gender:</strong> ${assessment.gender.charAt(0).toUpperCase() + assessment.gender.slice(1)}</div>
                                <div><strong>Height:</strong> ${assessment.height_cm} cm</div>
                                <div><strong>Weight:</strong> ${assessment.weight_kg} kg</div>
                                <div><strong>BMI:</strong> ${assessment.bmi} kg/m¬≤</div>
                            </div>
                        </div>

                        <div class="inference-section">
                            <h3>üìä Body Composition Analysis (Asian-Pacific & Indian Standards)</h3>
                            
                            <div class="inference-item">
                                <strong>BMI Category (Asian-Pacific Classification):</strong>
                                <div class="inference-value">${inference.bmi_category}</div>
                                <div style="font-size: 0.9em; color: #7F8C8D; margin-top: 8px;">
                                    Reference: <18.5 Underweight | 18.5-22.9 Normal | 23-24.9 Overweight | 25-29.9 Obese I | ‚â•30 Obese II
                                </div>
                            </div>

                            <div class="inference-item">
                                <strong>Body Fat %:</strong>
                                <div class="inference-value">${assessment.body_fat_percent}% - ${inference.body_fat_status}</div>
                                <div style="font-size: 0.9em; color: #7F8C8D; margin-top: 8px;">
                                    ${assessment.gender === 'male' ? 
                                        'Men Reference: <10% Low | 10-20% Normal | 20-25% High | ‚â•25% Very High' :
                                        'Women Reference: <20% Low | 20-30% Normal | 30-35% High | ‚â•35% Very High'}
                                </div>
                            </div>

                            <div class="inference-item">
                                <strong>Visceral Fat:</strong>
                                <div class="inference-value">${assessment.visceral_fat_percent} - ${inference.visceral_inference}</div>
                                <div style="font-size: 0.9em; color: #7F8C8D; margin-top: 8px;">
                                    Reference: 0-9.5 Normal | 10-14.5 High | 15-30 Very High
                                </div>
                            </div>

                            <div class="inference-item">
                                <strong>Metabolic Age:</strong>
                                <div class="inference-value">${assessment.metabolic_age} years (Actual: ${assessment.age} years)</div>
                                <div style="font-size: 0.9em; color: ${assessment.metabolic_age < assessment.age ? '#27AE60' : '#E67E22'}; margin-top: 8px;">
                                    ${assessment.metabolic_age < assessment.age ? 
                                        '‚úì Excellent! Metabolic age is better than actual age' :
                                        assessment.metabolic_age > assessment.age ?
                                        '‚ö† Focus on improving metabolic health' :
                                        'Metabolic age equals actual age'}
                                </div>
                            </div>
                        </div>

                        <div class="inference-section">
                            <h3>üí™ Muscle Mass Distribution Analysis</h3>
                            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                                <thead>
                                    <tr style="background: #2ECC71; color: white;">
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Body Part</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Fat %</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Muscle %</th>
                                        <th style="padding: 10px; text-align: center; border: 1px solid #ddd;">Ratio (Fat:Muscle)</th>
                                        <th style="padding: 10px; text-align: left; border: 1px solid #ddd;">Suggestions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="background: #f9f9f9;">
                                        <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Whole Body</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.whole_body_subcutaneous}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.whole_body_muscle}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${inference.muscle_distribution.whole_body.ratio}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd; font-size: 0.85em;">${inference.muscle_distribution.whole_body.suggestion}</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Trunk</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.trunk_subcutaneous}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.trunk_muscle}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${inference.muscle_distribution.trunk.ratio}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd; font-size: 0.85em;">${inference.muscle_distribution.trunk.suggestion}</td>
                                    </tr>
                                    <tr style="background: #f9f9f9;">
                                        <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Arms</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.arms_subcutaneous}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.arms_muscle}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${inference.muscle_distribution.arms.ratio}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd; font-size: 0.85em;">${inference.muscle_distribution.arms.suggestion}</td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 8px; font-weight: bold; border: 1px solid #ddd;">Legs</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.legs_subcutaneous}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${assessment.legs_muscle}</td>
                                        <td style="padding: 8px; text-align: center; border: 1px solid #ddd;">${inference.muscle_distribution.legs.ratio}</td>
                                        <td style="padding: 8px; border: 1px solid #ddd; font-size: 0.85em;">${inference.muscle_distribution.legs.suggestion}</td>
                                    </tr>
                                </tbody>
                            </table>
                            <div style="font-size: 0.9em; color: #7F8C8D; margin-top: 12px; padding: 10px; background: #f0f0f0; border-radius: 5px;">
                                <strong>üìä Ratio Guide:</strong> Optimal ratio for athletes is 1:2 to 1:3 (more muscle than fat).
                                Example: 1:2.5 means 1 part fat to 2.5 parts muscle.
                            </div>
                        </div>

                        <div class="performance-notes" style="margin-top: 20px;">
                            <h4>üèÉ‚Äç‚ôÇÔ∏è Performance Notes for Runners/Marathon Athletes:</h4>
                            <ul style="margin-top: 10px; line-height: 1.8; list-style-type: disc; padding-left: 25px;">
                                ${Array.isArray(inference.performance_notes) ? 
                                    inference.performance_notes.map(note => `<li>${note.replace(/^[‚Ä¢‚óè‚ñ†‚óÜ‚ñ™]-?\s*/, '')}</li>`).join('') :
                                    inference.performance_notes.split('\n').filter(note => note.trim()).map(note => `<li>${note.replace(/^[‚Ä¢‚óè‚ñ†‚óÜ‚ñ™]-?\s*/, '')}</li>`).join('')
                                }
                            </ul>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: #E8F4F8; border-radius: 5px; font-size: 0.9em;">
                            <strong>üí° Recommendations:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Maintain regular body composition monitoring to track progress</li>
                                <li>Focus on balanced nutrition tailored for endurance athletes</li>
                                <li>Consider consultation with sports nutritionist for personalized guidance</li>
                                <li>Monitor recovery and adjust training load based on body composition changes</li>
                            </ul>
                        </div>
                    `;
                } else {
                    content.innerHTML = `<p style="text-align: center; color: #E74C3C;">${result.message}</p>`;
                }
            } catch (error) {
                content.innerHTML = `<p style="text-align: center; color: #E74C3C;">Error loading inference: ${error.message}</p>`;
            }
        }

        function closeInferenceModal() {
            document.getElementById('inferenceModal').className = 'modal';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('inferenceModal');
            if (event.target == modal) {
                closeInferenceModal();
            }
        }
    </script>
</body>
</html>
